{
    "manifests": {
        "onlishop/platform": {
            "manifest": {
                "copy-from-recipe": {
                    "config/": "%CONFIG_DIR%/"
                },
                "bundles": {
                    "Onlishop\\Elasticsearch\\Elasticsearch": [
                        "all"
                    ]
                },
                "env": {
                    "OPENSEARCH_URL": "http://localhost:9200",
                    "ONLISHOP_ES_ENABLED": "0",
                    "ONLISHOP_ES_INDEXING_ENABLED": "0",
                    "ONLISHOP_ES_INDEX_PREFIX": "sw",
                    "ONLISHOP_ES_THROW_EXCEPTION": "1"
                },
                "container": {
                    "env(OPENSEARCH_URL)": "http://localhost:9200"
                },
                "docker-compose": {
                    "docker-compose.yml": {
                        "services": [
                            "opensearch:",
                            "  image: opensearchproject/opensearch:2",
                            "  volumes:",
                            "    - opensearch-data:/usr/share/opensearch/data",
                            "  environment:",
                            "    OPENSEARCH_INITIAL_ADMIN_PASSWORD: 'c3o_ZPHo!'",
                            "    discovery.type: single-node",
                            "    plugins.security.disabled: 'true'"
                        ],
                        "volumes": [
                            "opensearch-data:"
                        ]
                    },
                    "docker-compose.override.yml": {
                        "services": [
                            "opensearch:",
                            "  ports:",
                            "    - \"9200\""
                        ]
                    }
                }
            },
            "files": {
                "bin/build-administration.sh": {
                    "contents": [
                        "#!/usr/bin/env bash",
                        "",
                        "unset CDPATH",
                        "CWD=\"$(cd -P -- \"$(dirname -- \"${BASH_SOURCE[0]}\")\" && pwd -P)\"",
                        "",
                        "export PROJECT_ROOT=\"${PROJECT_ROOT:-\"$(dirname \"$CWD\")\"}\"",
                        "export ENV_FILE=${ENV_FILE:-\"${PROJECT_ROOT}/.env\"}",
                        "",
                        "# shellcheck source=functions.sh",
                        "source \"${PROJECT_ROOT}/bin/functions.sh\"",
                        "",
                        "curenv=$(declare -p -x)",
                        "",
                        "load_dotenv \"$ENV_FILE\"",
                        "",
                        "# Restore environment variables set globally",
                        "set -o allexport",
                        "eval \"$curenv\"",
                        "set +o allexport",
                        "",
                        "set -euo pipefail",
                        "",
                        "export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true",
                        "export DISABLE_ADMIN_COMPILATION_TYPECHECK=true",
                        "export PROJECT_ROOT=\"${PROJECT_ROOT:-\"$(dirname \"$CWD\")\"}\"",
                        "",
                        "if [[ -e \"${PROJECT_ROOT}/vendor/onlishop/platform\" ]]; then",
                        "    ADMIN_ROOT=\"${ADMIN_ROOT:-\"${PROJECT_ROOT}/vendor/onlishop/platform/src/Administration\"}\"",
                        "else",
                        "    ADMIN_ROOT=\"${ADMIN_ROOT:-\"${PROJECT_ROOT}/vendor/onlishop/administration\"}\"",
                        "fi",
                        "",
                        "BIN_TOOL=\"${CWD}/console\"",
                        "",
                        "if [[ ${CI:-\"\"} ]]; then",
                        "    BIN_TOOL=\"${CWD}/ci\"",
                        "",
                        "    if [[ ! -x \"$BIN_TOOL\" ]]; then",
                        "        chmod +x \"$BIN_TOOL\"",
                        "    fi",
                        "fi",
                        "",
                        "# build admin",
                        "[[ ${ONLISHOP_SKIP_BUNDLE_DUMP:-\"\"} ]] || \"${BIN_TOOL}\" bundle:dump",
                        "\"${BIN_TOOL}\" feature:dump || true",
                        "",
                        "if [[ $(command -v jq) ]]; then",
                        "    OLDPWD=$(pwd)",
                        "    cd \"$PROJECT_ROOT\" || exit",
                        "",
                        "    jq -c '.[]' \"var/plugins.json\" | while read -r config; do",
                        "        srcPath=$(echo \"$config\" | jq -r '(.basePath + .administration.path)')",
                        "",
                        "        # the package.json files are always one upper",
                        "        path=$(dirname \"$srcPath\")",
                        "        name=$(echo \"$config\" | jq -r '.technicalName' )",
                        "",
                        "        skippingEnvVarName=\"SKIP_$(echo \"$name\" | sed -e 's/\\([a-z]\\)/\\U\\1/g' -e 's/-/_/g')\"",
                        "",
                        "        if [[ ${!skippingEnvVarName:-\"\"} ]]; then",
                        "            continue",
                        "        fi",
                        "",
                        "        if [[ -f \"$path/package.json\" && ! -d \"$path/node_modules\" && $name != \"administration\" ]]; then",
                        "            echo \"=> Installing npm dependencies for ${name}\"",
                        "",
                        "            npm install --prefix \"$path\" --no-audit --prefer-offline",
                        "        fi",
                        "    done",
                        "    cd \"$OLDPWD\" || exit",
                        "else",
                        "    echo \"Cannot check extensions for required npm installations as jq is not installed\"",
                        "fi",
                        "",
                        "(cd \"${ADMIN_ROOT}\"/Resources/app/administration && npm install --no-audit --prefer-offline)",
                        "",
                        "# Dump entity schema",
                        "if [[ -z \"${ONLISHOP_SKIP_ENTITY_SCHEMA_DUMP:-\"\"}\" ]] && [[ -f \"${ADMIN_ROOT}\"/Resources/app/administration/scripts/entitySchemaConverter/entity-schema-converter.ts ]]; then",
                        "  mkdir -p \"${ADMIN_ROOT}\"/Resources/app/administration/test/_mocks_",
                        "  \"${BIN_TOOL}\" -e prod framework:schema -s 'entity-schema' \"${ADMIN_ROOT}\"/Resources/app/administration/test/_mocks_/entity-schema.json",
                        "  (cd \"${ADMIN_ROOT}\"/Resources/app/administration && npm run convert-entity-schema)",
                        "fi",
                        "",
                        "(cd \"${ADMIN_ROOT}\"/Resources/app/administration && npm run build)",
                        "[[ ${ONLISHOP_SKIP_ASSET_COPY:-\"\"} ]] ||\"${BIN_TOOL}\" assets:install",
                        ""
                    ],
                    "executable": true
                },
                "bin/watch-administration.sh": {
                    "contents": [
                        "#!/usr/bin/env bash",
                        "",
                        "CWD=\"$(cd -P -- \"$(dirname -- \"${BASH_SOURCE[0]}\")\" && pwd -P)\"",
                        "",
                        "export PROJECT_ROOT=\"${PROJECT_ROOT:-\"$(dirname \"$CWD\")\"}\"",
                        "export ENV_FILE=${ENV_FILE:-\"${PROJECT_ROOT}/.env\"}",
                        "",
                        "# shellcheck source=functions.sh",
                        "source \"${PROJECT_ROOT}/bin/functions.sh\"",
                        "",
                        "curenv=$(declare -p -x)",
                        "",
                        "load_dotenv \"$ENV_FILE\"",
                        "",
                        "# Restore environment variables set globally",
                        "set -o allexport",
                        "eval \"$curenv\"",
                        "set +o allexport",
                        "",
                        "export HOST=${HOST:-\"localhost\"}",
                        "export ESLINT_DISABLE",
                        "export PORT",
                        "export APP_URL",
                        "export DISABLE_ADMIN_COMPILATION_TYPECHECK=1",
                        "",
                        "BIN_TOOL=\"${CWD}/console\"",
                        "",
                        "[[ ${ONLISHOP_SKIP_BUNDLE_DUMP:-\"\"} ]] || \"${BIN_TOOL}\" bundle:dump",
                        "\"${BIN_TOOL}\" feature:dump || true",
                        "",
                        "if [[ $(command -v jq) ]]; then",
                        "    OLDPWD=$(pwd)",
                        "    cd \"$PROJECT_ROOT\" || exit",
                        "",
                        "    jq -c '.[]' \"var/plugins.json\" | while read -r config; do",
                        "        srcPath=$(echo \"$config\" | jq -r '(.basePath + .administration.path)')",
                        "",
                        "        # the package.json files are always one upper",
                        "        path=$(dirname \"$srcPath\")",
                        "        name=$(echo \"$config\" | jq -r '.technicalName' )",
                        "",
                        "        skippingEnvVarName=\"SKIP_$(echo \"$name\" | sed -e 's/\\([a-z]\\)/\\U\\1/g' -e 's/-/_/g')\"",
                        "",
                        "        if [[ ${!skippingEnvVarName:-\"\"} ]]; then",
                        "            continue",
                        "        fi",
                        "",
                        "        if [[ -f \"$path/package.json\" && ! -d \"$path/node_modules\" && $name != \"administration\" ]]; then",
                        "            echo \"=> Installing npm dependencies for ${name}\"",
                        "",
                        "            npm install --prefix \"$path\"",
                        "        fi",
                        "    done",
                        "    cd \"$OLDPWD\" || exit",
                        "else",
                        "    echo \"Cannot check extensions for required npm installations as jq is not installed\"",
                        "fi",
                        "",
                        "if [ ! -d vendor/onlishop/administration/Resources/app/administration/node_modules ]; then",
                        "    npm install --prefix vendor/onlishop/administration/Resources/app/administration/",
                        "fi",
                        "",
                        "# Dump entity schema",
                        "if [[ -z \"${ONLISHOP_SKIP_ENTITY_SCHEMA_DUMP:-\"\"}\" ]] && [[ -f \"${ADMIN_ROOT}\"/Resources/app/administration/scripts/entitySchemaConverter/entity-schema-converter.ts ]]; then",
                        "  mkdir -p \"${ADMIN_ROOT}\"/Resources/app/administration/test/_mocks_",
                        "  \"${BIN_TOOL}\" -e prod framework:schema -s 'entity-schema' \"${ADMIN_ROOT}\"/Resources/app/administration/test/_mocks_/entity-schema.json",
                        "  (cd \"${ADMIN_ROOT}\"/Resources/app/administration && npm run convert-entity-schema)",
                        "fi",
                        "",
                        "npm run --prefix vendor/onlishop/administration/Resources/app/administration/ dev",
                        ""
                    ],
                    "executable": true
                },
                "config/packages/elasticsearch.yaml": {
                    "contents": [
                        "elasticsearch:",
                        "    hosts: \"%env(string:OPENSEARCH_URL)%\"",
                        "",
                        ""
                    ],
                    "executable": false
                }
            },
            "ref": "6e24458390581930fb7884d3770c79cb9da53951"
        }
    }
}
